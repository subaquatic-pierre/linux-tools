upstream app_server {
		server localhost:8000;
	}


server { 
    	listen 443 ssl http2; # managed by Certbot
	server_name divesandybeach.com;
	client_max_body_size 10M;
	gzip on;
	gzip_comp_level 9;
	gzip_min_length 256;
	gzip_proxied any;
	gzip_vary on;

	gzip_types
	    application/atom+xml
	    application/javascript
	    application/json
	    application/ld+json
	    application/manifest+json
	    application/rss+xml
	    application/vnd.geo+json
	    application/vnd.ms-fontobject
	    application/x-font-ttf
	    application/x-web-app-manifest+json
	    application/xhtml+xml
	    application/xml
	    font/opentype
	    image/bmp
	    image/svg+xml
	    image/x-icon
	    text/cache-manifest
	    text/css
	    text/plain
	    text/vcard
	    text/vnd.rim.location.xloc
	    text/vtt
	    text/x-component
	    text/x-cross-domain-policy;
	    # text/html is always compressed by gzip module


	location /media {
		alias /home/ubuntu/divesandybeach/media_root;
		proxy_cache_valid any 1m;
		proxy_cache_min_uses 3;
		proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
	}
	
	location /static {
		gzip_static on;
		proxy_cache_valid any 1m;
		proxy_cache_min_uses 3;
		proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;
		alias /home/ubuntu/divesandybeach/static_root;
	}
	
	location / {
		proxy_pass http://localhost:8000;
		include /etc/nginx/proxy_params;
		proxy_redirect off;	
	}		



	ssl_certificate /etc/letsencrypt/live/divesandybeach.com/fullchain.pem; 
	ssl_certificate_key /etc/letsencrypt/live/divesandybeach.com/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
	ssl_protocols TLSv1.3;

}


server {
	listen 80;
	server_name www.divesandybeach.com;

	return 301 https://divesandybeach.com$request_uri;

}

server {
	listen 443 ssl http2;
	server_name www.divesandybeach.com;

	return 301 https://divesandybeach.com$request_uri;

}


server {
    if ($host = divesandybeach.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

	if ($host = www.divesandybeach.com) {
		return 301 https://divesandybeach.com$request_uri;
	}


	listen 80; 
	server_name divesandybeach.com;
    return 404; # managed by Certbot


}